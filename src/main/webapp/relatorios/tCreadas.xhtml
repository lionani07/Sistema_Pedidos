<!DOCTYPE html>
<ui:composition template="/WEB-INF/template/template_aernnova.xhtml"
xmlns="http://www.w3.org/1999/xhtml"
xmlns:f="http://xmlns.jcp.org/jsf/core"
xmlns:h="http://xmlns.jcp.org/jsf/html"
xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
xmlns:p="http://primefaces.org/ui">

<f:metadata>
<f:viewAction action="#{tarefaBean.listarTarefasCreadas()}" />
<f:viewAction action="#{tarefaBean.cargarResponsavel}" />
<f:viewAction action="#{tarefaBean.cargarSubLideres}" />
</f:metadata>

<ui:define name="corpo">
<p:fieldset id="cont" legend="Tarefas Sem Aprovar #{tarefaBean.tarefasCreadas.size()}" style="margin-bottom:20px">
<h:form id="frmtC">
<p:growl id="growl"  showDetail="false" showSummary="true" autoUpdate="true" />

<p:dataTable id="tbltCreadas" rendered="#{not empty tarefaBean.tarefasCreadas}" value="#{tarefaBean.tarefasCreadas}" var="tarefa" widgetVar="tarefasTable" rowKey="#{tarefa.id}" selectionMode="single"
paginator="true" rows="20" paginatorPosition="top">

<f:facet name="header">
<div align="left">
<p:commandButton value="Refrescar" icon="ui-icon-refresh" action="/tarefas/relatorios/tCreadas?faces-redirect=true" />
</div>
</f:facet>
<p:column headerText="Codigo" style="text-align: center" sortBy="#{tarefa.id}" filterBy="#{tarefa.id}" filterMatchMode="contains">
<h:outputText value="#{tarefa.id}" />
</p:column>

<p:column headerText="Titulo" style="text-align: center" filterBy="#{tarefa.titulo}" filterMatchMode="contains" >
<h:outputText value="#{tarefa.titulo}" />
</p:column>

<p:column headerText="Responsavel" style="text-align:center" filterBy="#{tarefa.responsavel.id}" filterMatchMode="exact">
<f:facet name="filter">
<p:selectOneMenu onchange="PF('tarefasTable').filter()">
<f:selectItem itemLabel="Todos" itemValue="#{null}" noSelectionOption="true" />
<f:selectItems value="#{tarefaBean.pessoas}" var="pessoa" itemValue="#{pessoa.id}" itemLabel="#{pessoa.nome}" />
</p:selectOneMenu>
</f:facet>
<h:outputText value="#{tarefa.responsavel.nome}" />
</p:column>

<p:column headerText="Origen" style="text-align: center" filterBy="#{tarefa.origen}" filterMatchMode="exact">
<f:facet name="filter">
<p:selectOneMenu onchange="PF('tarefasTable').filter()">
			<f:selectItem itemLabel="Todos" itemValue="#{null}" noSelectionOption="true" />
           <f:selectItems value="#{tarefaBean.todosOrigen}" />
</p:selectOneMenu>
</f:facet>
<h:outputText value="#{tarefa.origen.descricao}" />
</p:column>

<p:column width="75px" headerText="Proyeto" style="text-align: center" filterBy="#{tarefa.proyeto.descricao}"  filterMatchMode="exact">
   <f:facet name="filter">
       <p:selectOneMenu onchange="PF('tarefasTable').filter()" >
           <f:selectItem itemLabel="Todos" itemValue="#{null}" noSelectionOption="true" />
           <f:selectItems value="#{tarefaBean.todosProyetos}" />
      </p:selectOneMenu>
   </f:facet>
<h:outputText value="#{tarefa.proyeto.descricao}" />
</p:column>

<p:column style="width: 150px; text-align:center" headerText="Data de Creaçao" sortBy="#{tarefa.dataCreacao}" filterBy="#{tarefa.dataCreacao}" filterFunction="#{dateRangeFilter.filterByDate}">
  <f:facet name="filter">
    <h:inputHidden id="filter" />
  </f:facet>
  <f:facet name="header">
    <h:outputText value="Data de Creaçao" />
    <br />
    <div align="left">
    <p:outputLabel value="De:"/>
    </div>    
    <p:calendar id="from" pattern="dd/MM/yyyy" value="#{dateRangeFilter.from}" maxdate="#{dateRangeFilter.to}">      
     <p:ajax event="change" update="to"/>
      <p:ajax event="dateSelect" update="to" onstart="$(PrimeFaces.escapeClientId('#{p:component('filter')}'))[0].value = $(PrimeFaces.escapeClientId('#{p:component('from')}_input'))[0].value + '-' + $(PrimeFaces.escapeClientId('#{p:component('to')}_input'))[0].value" oncomplete="PF('tarefasTable').filter()" />
    </p:calendar>
    <div align="left">
    <p:outputLabel value="Até"/>
    </div>
    <p:calendar id="to" pattern="dd/MM/yyyy" value="#{dateRangeFilter.to}" mindate="#{dateRangeFilter.from}">
    <p:ajax event="change" update="from"/>    
    <p:ajax event="dateSelect" update="from" onstart="$(PrimeFaces.escapeClientId('#{p:component('filter')}'))[0].value = $(PrimeFaces.escapeClientId('#{p:component('from')}_input'))[0].value + '-' + $(PrimeFaces.escapeClientId('#{p:component('to')}_input'))[0].value" oncomplete="PF('tarefasTable').filter()" />
    </p:calendar>
  </f:facet>
  <h:outputText value="#{tarefa.dataCreacao}">
    <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Sao_Paulo" />
  </h:outputText>
</p:column>


</p:dataTable>
</h:form>


<h:form id="frm_dialogUpdateTarefa">
<p:dialog header="Actualizar Tarefa" widgetVar="dlgUpdateTarefa" id="idDlgUpdateTarefa" resizable="false" modal="true" showEffect="side" hideEffect="explode">
<p:panelGrid columns="4" rendered="#{not empty tarefaBean.tarefaSelecionada}">

<p:outputLabel value="Titulo" for="titulo" /> 
<p:inputTextarea id="titulo"  value="#{tarefaBean.tarefaSelecionada.titulo}" style="width: 220px" rows="2" cols="40" autoResize="true" />

<p:outputLabel value="Responsavel" for="responsavel" />
<p:selectOneMenu value="#{tarefaBean.tarefaSelecionada.responsavel}" id="responsavel" filter="true" filterMatchMode="contains" style="width: 200px"  >
<f:selectItem itemLabel="Seleccione Responsavel" noSelectionOption="true"/>
<f:selectItems value="#{tarefaBean.pessoas}" var="pessoa" itemValue="#{pessoa}" itemLabel="#{pessoa.nome}"  />
</p:selectOneMenu>

<p:outputLabel value="Origen" for="origen" />
<p:selectOneMenu value="#{tarefaBean.tarefaSelecionada.origen}" id="origen" style="width: 200px">
<f:selectItem itemLabel="Selecione Origen" noSelectionOption="true" />
<f:selectItems value="#{tarefaBean.todosOrigen}" var="tipoOrigen"  itemValue="#{tipoOrigen}" itemLabel="#{tipoOrigen.descricao}" />
</p:selectOneMenu>

<p:outputLabel value="Proyeto" for="proyeto" />
<p:selectOneMenu value="#{tarefaBean.tarefaSelecionada.proyeto}" id="proyeto" style="width: 200px">
<f:selectItem itemLabel="Seleccione Proyeto" noSelectionOption="true" />
<f:selectItems value="#{tarefaBean.todosProyetos}" var="tipoProyeto" itemValue="#{tipoProyeto}" itemLabel="#{tipoBeneficio.tipoProyeto}" />
</p:selectOneMenu>

<f:facet name="footer">
<p:commandButton value="Salvar" icon="ui-icon-disk" actionListener="#{tarefaBean.updateTarefaAdmin}" oncomplete="updateTarefa(xhr, status, args)" update=":frmtC :template" />
<p:commandButton value="Cancel"  icon="ui-icon-close" onclick="PF('dlgUpdateTarefa').hide();"/>
</f:facet>
</p:panelGrid>
</p:dialog>
</h:form>

<script type="text/javascript">
    function updateTarefa(xhr, status, args) {
        if(args.validationFailed || !args.update) {
            PF('dlgUpdateTarefa').jq.effect("shake", {times:5}, 100);
        }
        else {
            PF('dlgUpdateTarefa').hide();           
        }
    }
</script>





</p:fieldset>
</ui:define>
</ui:composition>